package com.pussycat.minions.test;

import java.util.Random;
import java.util.concurrent.TimeUnit;

import android.test.ActivityInstrumentationTestCase2;
import android.util.Log;
import android.view.SurfaceView;

import com.pussycat.framework.FPSCounter;
import com.pussycat.framework.Game;
import com.pussycat.framework.Screen;
import com.pussycat.minions.BallHandler;
import com.pussycat.minions.GameScreen;
import com.pussycat.minions.PussycatMinions;
import com.pussycat.minions.TCPClient;

public class PussycatMinionsTest extends
		ActivityInstrumentationTestCase2<PussycatMinions> {

	PussycatMinions pussycatMinions;
	SurfaceView view;
	Screen screen;
	GameScreen gameScreen;
	Game game;
	FPSCounter fpsCounter;
	BallHandler ballHandler;
	TCPClient tcpClient;
	Random r;
	
	public PussycatMinionsTest() {
		super(PussycatMinions.class);
	}

	@Override
	protected void setUp() throws Exception {
		super.setUp();
		//setActivityInitialTouchMode(false);
		pussycatMinions = getActivity();
	}
	
	public void testFPS() {
		pussycatMinions.runOnUiThread(
				new Runnable() {
					public void run() {
						int numberOfBalls = 500;
						int acceptedFPS = 50;
						
						r = new Random();
						int maxY = pussycatMinions.getScreenHeight();
						int maxX = pussycatMinions.getScreenHeight();
						int fps = 0;
						
						screen = pussycatMinions.getCurrentScreen();
						game = screen.getCurrentGame();
						game.setScreen(new GameScreen(game));
						GameScreen gameScreen = (GameScreen) game.getCurrentScreen();
						fpsCounter = gameScreen.getFPSCounter();
						ballHandler = gameScreen.getBallHandler();
						tcpClient = ballHandler.getTCPClient();
						if(tcpClient != null) {
							for(int i = 0; i < numberOfBalls; i++) {
								int x = r.nextInt(maxX);
								int y = r.nextInt(maxY);
								fps = fpsCounter.getFPS();
								Log.d("TEST", x + " " + y);
								tcpClient.sendMessage(x + " " + y + " " + 0 + " " + 0);
							}
						}
						Log.d("TEST",fpsCounter.getFPS() + "");
						//assertTrue(fpsCounter.getFPS() > 0);
					}
				});
		pussycatMinions.runOnUiThread(
				new Runnable(){
					public void run(){
						//assertTrue(fpsCounter.getFPS() > 0);
					}
		});
	}
}
