package com.pussycat.minions.test;

import java.util.Random;

import android.test.ActivityInstrumentationTestCase2;
import android.util.Log;
import android.view.SurfaceView;

import com.pussycat.framework.FPSCounter;
import com.pussycat.framework.Game;
import com.pussycat.framework.Screen;
import com.pussycat.minions.BallHandler;
import com.pussycat.minions.GameScreen;
import com.pussycat.minions.PussycatMinions;
import com.pussycat.minions.TCPClient;

public class PussycatMinionsTest extends
		ActivityInstrumentationTestCase2<PussycatMinions> {

	PussycatMinions pussycatMinions;
	SurfaceView view;
	Screen screen;
	GameScreen gameScreen;
	Game game;
	FPSCounter fpsCounter;
	BallHandler ballHandler;
	TCPClient tcpClient;
	Random r;
	
	public PussycatMinionsTest() {
		super(PussycatMinions.class);
	}

	@Override
	protected void setUp() throws Exception {
		super.setUp();
		//setActivityInitialTouchMode(false);
		pussycatMinions = getActivity();
		r = new Random();

		/*
		screen = pussycatMinions.getCurrentScreen();
		game = screen.getCurrentGame();
		
		if(screen.getClass() == GameScreen.class) {
			gameScreen = (GameScreen) screen;
			fpsCounter = gameScreen.getFPSCounter();
		}
		*/
	}
	
	public void testFPS() {
		pussycatMinions.runOnUiThread(
				new Runnable() {
					public void run() {
						int maxX = pussycatMinions.getScreenHeight();
						int maxY = pussycatMinions.getScreenHeight();
						
						screen = pussycatMinions.getCurrentScreen();
						//view = (SurfaceView) pussycatMinions.getCurrentFocus();
						game = screen.getCurrentGame();
						game.setScreen(new GameScreen(game));
						GameScreen gameScreen = (GameScreen) game.getCurrentScreen();
						//view = (SurfaceView) pussycatMinions.getCurrentFocus();
						//Log.d("TEST",view.toString());
						fpsCounter = gameScreen.getFPSCounter();
						ballHandler = gameScreen.getBallHandler();
						tcpClient = ballHandler.getTCPClient();
						if(tcpClient != null) {
							for(int i = 0; i < 500; i++) {
								x = r.nextInt(maxX);
								tcpClient.sendMessage(0 + " " + 0 + " " + 0 + " " + 0);
							}
						}
						//view = (AndroidFastRenderView) pussycatMinions.getCurrentFocus();
						Log.d("TEST",screen.toString());
						Log.d("TEST",game.toString());
						/*view.requestFocus();
						MotionEvent motionEvent = MotionEvent.obtain(SystemClock.uptimeMillis(), SystemClock.uptimeMillis()+10, MotionEvent.ACTION_UP, 0, 0, 0);
						view.dispatchTouchEvent(motionEvent);
						motionEvent.recycle();*/
					}
				});
	}
}
